<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Solver API Test</title>
    <style>
        /* Same styles as before */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(9, 40px);
            gap: 1px;
            margin: 20px 0;
        }
        .cell {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background-color: #f9f9f9;
        }
        .cell input {
            width: 30px;
            height: 30px;
            font-size: 18px;
            text-align: center;
            border: none;
            outline: none;
            background-color: transparent;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        .controls {
            margin: 20px 0;
        }
        .response {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f5f5f5;
            white-space: pre-wrap;
        }
        .size-select {
            margin-bottom: 10px;
        }
        .server-settings {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f8f8f8;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Sudoku Solver API Test</h1>
    
    <div class="server-settings">
        <h3>Server Settings</h3>
        <div>
            <label for="serverUrl">Server URL:</label>
            <input type="text" id="serverUrl" value="http://localhost:8080" style="width: 250px;">
        </div>
        <div>
            <button onclick="testConnection()">Test Connection</button>
            <span id="connectionStatus"></span>
        </div>
    </div>
    
    <div class="size-select">
        <label for="size">Select Sudoku Size:</label>
        <select id="size" onchange="changeSudokuSize()">
            <option value="9">9x9 (Standard)</option>
            <option value="6">6x6</option>
            <option value="4">4x4</option>
        </select>
    </div>
    
    <div class="controls">
        <label>
            <input type="checkbox" id="markingMode"> Marking Mode
        </label>
    </div>
    
    <div id="sudokuGrid" class="grid-container"></div>
    
    <button onclick="fillSampleData()">Fill Sample Data</button>
    <button onclick="clearGrid()">Clear Grid</button>
    <button onclick="submitSudoku()">Solve Sudoku</button>
    
    <div>
        <h3>API Response:</h3>
        <div id="response" class="response">No response yet</div>
    </div>
    
    <div>
        <h3>Debug Info:</h3>
        <div id="debug" class="response"></div>
    </div>
    
    <script>
        let currentSize = 9;
        let gridCells = [];
        
        function createGrid(size) {
            const gridContainer = document.getElementById('sudokuGrid');
            gridContainer.innerHTML = '';
            gridContainer.style.gridTemplateColumns = `repeat(${size}, 40px)`;
            
            gridCells = [];
            
            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.maxLength = 1;
                input.dataset.index = i;
                input.addEventListener('input', function(e) {
                    // Allow only numbers from 0-9 or empty
                    this.value = this.value.replace(/[^0-9]/g, '');
                    
                    // Ensure the number doesn't exceed the grid size
                    if (parseInt(this.value) > size) {
                        this.value = '';
                    }
                });
                
                cell.appendChild(input);
                gridContainer.appendChild(cell);
                gridCells.push(input);
            }
        }
        
        function changeSudokuSize() {
            currentSize = parseInt(document.getElementById('size').value);
            createGrid(currentSize);
        }
        
        function getGridData() {
            return gridCells.map(input => {
                return input.value === '' ? 0 : parseInt(input.value);
            });
        }
        
        function testConnection() {
            const serverUrl = document.getElementById('serverUrl').value;
            const statusEl = document.getElementById('connectionStatus');
            
            statusEl.textContent = "Testing connection...";
            statusEl.className = "";
            
            // We'll just try to make a simple OPTIONS request to check connectivity
            fetch(`${serverUrl}/api/process-tuple`, {
                method: 'OPTIONS',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    statusEl.textContent = "✓ Connection successful!";
                    statusEl.style.color = "green";
                } else {
                    statusEl.textContent = "✗ Server responded but with an error: " + response.status;
                    statusEl.style.color = "red";
                }
            })
            .catch(error => {
                statusEl.textContent = "✗ Connection failed: " + error.message;
                statusEl.style.color = "red";
                
                // Additional debug info
                document.getElementById('debug').textContent = `
Error details: ${error.toString()}
                
Common solutions:
1. Make sure your Rust server is running
2. Check if the URL is correct
3. Try opening ${serverUrl} directly in your browser
4. Make sure CORS is properly configured on the server
5. If using Chrome, try a different browser like Firefox
6. If running the server locally, make sure to use http:// (not https://)
                `;
            });
        }
        
        function submitSudoku() {
            const data = getGridData();
            const markingMode = document.getElementById('markingMode').checked;
            const serverUrl = document.getElementById('serverUrl').value;
            
            const payload = {
                data: data,
                length: currentSize * currentSize,
                markingmode: markingMode
            };
            
            document.getElementById('response').textContent = "Sending request...";
            document.getElementById('debug').textContent = `
Request URL: ${serverUrl}/api/process-tuple
Request method: POST
Request payload: ${JSON.stringify(payload, null, 2)}
            `;
            
            fetch(`${serverUrl}/api/process-tuple`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                document.getElementById('debug').textContent += `\nResponse status: ${response.status} ${response.statusText}`;
                return response.json();
            })
            .then(result => {
                document.getElementById('response').textContent = JSON.stringify(result, null, 2);
                
                if (result.hassolution) {
                    displaySolution(result.data);
                }
            })
            .catch(error => {
                document.getElementById('response').innerHTML = '<span class="error">Error: ' + error.message + '</span>';
                document.getElementById('debug').textContent += `\nError: ${error.toString()}`;
            });
        }
        
        function displaySolution(solution) {
            for (let i = 0; i < gridCells.length && i < solution.length; i++) {
                if (solution[i] !== 0) {
                    gridCells[i].value = solution[i];
                    gridCells[i].style.backgroundColor = '#d4edda';
                }
            }
        }
        
        function fillSampleData() {
            clearGrid();
            
            if (currentSize === 9) {
                // Sample 9x9 puzzle
                const sample = [0, 7, 0, 0, 0, 0, 0, 4, 3, 0, 4, 0, 0, 0, 9, 6, 1, 0, 8, 0, 0, 6, 3, 4, 9, 0, 0, 0, 9, 4, 0, 5, 2, 0, 0, 0, 3, 5, 8, 4, 6, 0, 0, 2, 0, 0, 0, 0, 8, 0, 0, 5, 3, 0, 0, 8, 0, 0, 7, 0, 0, 9, 1, 9, 0, 2, 1, 0, 0, 0, 0, 5, 0, 0, 7, 0, 4, 0, 8, 0, 2];
                for (let i = 0; i < sample.length && i < gridCells.length; i++) {
                    if (sample[i] !== 0) {
                        gridCells[i].value = sample[i];
                    }
                }
            } else if (currentSize === 6) {
                // Sample 6x6 puzzle
                const sample = [0, 0, 0, 5, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 4, 0, 2, 0, 5, 0, 0, 0, 4, 6, 0, 0, 0, 0, 3, 0, 0, 1, 0, 0, 0];
                for (let i = 0; i < sample.length && i < gridCells.length; i++) {
                    if (sample[i] !== 0) {
                        gridCells[i].value = sample[i];
                    }
                }
            } else if (currentSize === 4) {
                // Sample 4x4 puzzle
                const sample = [0, 0, 3, 4, 0, 0, 0, 0, 0, 1, 0, 0, 4, 0, 0, 0];
                for (let i = 0; i < sample.length && i < gridCells.length; i++) {
                    if (sample[i] !== 0) {
                        gridCells[i].value = sample[i];
                    }
                }
            }
        }
        
        function clearGrid() {
            gridCells.forEach(input => {
                input.value = '';
                input.style.backgroundColor = '';
            });
            document.getElementById('response').textContent = 'No response yet';
            document.getElementById('debug').textContent = '';
        }
        
        // Initialize with 9x9 grid
        createGrid(currentSize);
    </script>
</body>
</html>
